<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8"/>
<style>
div {
    width: 100px;
    height: 200px;
    border: 1px solid black;
}
</style>
</head>
<body>

<h1>Motordriver</h1>

<p><strong>Tip:</strong> Try to click different places in the box to speed up motors.<br> 
Center means 0,0 i.e. stop. Click towards top runs forward, a click towards bottom runs backward.
Once the mouse moves out of the box, motors come to a still.
</p>

Enable Motor: <input type="checkbox" id="enableMotor">


<div onclick="setMousePosition(event)" onmousemove="speedMotors(event)" onmouseout="stop()"></div>


<TABLE BORDER="0">
<TR>
<TD></TD>
<TD><button onclick="forward()">forward</button></TD>
<TD></TD>
</TR>
<TR>
<TD><button onclick="left()">left</button></TD>
<TD><button onclick="stop()">stop</button></TD>
<TD><button onclick="right()">right</button></TD>
</TR>
<TR>
<TD></TD>
<TD><button onclick="backward()">backward</button></TD>
<TD></TD>
</TR>
<TR>
<TD><button onclick="speed1()">speed1</button></TD>
<TD><button onclick="speed2()">speed2</button></TD>
<TD><button onclick="speed3()">speed3</button></TD>
</TR>

</TABLE>



<p id="demo"></p>

<script>

var speed = 0;

function speed1() {
	speed = 25;
}

function speed2() {
	speed = 50;
}

function speed3() {
	speed = 100;
}

function stop() {
	send(0, 0);
}

function forward() {
	send(speed, speed);
}

function left() {
	send(0, speed);
}

function right() {
	send(speed, 0);
}

function backward() {
	send(-speed, -speed);
}






var offsetX ;
var offsetY ;
var x;
var y;

function setMousePosition(event) {
	console.log("setMousePosition called ");
    x = event.clientX;
    y = event.clientY;
    offsetX = x ;
    offsetY = y ;
    var response = "Offest ("+x+"/"+y+")";
    document.getElementById('demo').innerHTML = response;
}

function speedMotors(event) {
    x = event.clientX;
    y = event.clientY;
	var m1 = 0;
	var m2 = 0;
	if (offsetX != 0)
	{
		var divX = offsetX - x;
		var divY = offsetY - y;
		m1 = divY  + divX;
		m2 = divY  - divX;
	}
	send(m1,m2);
}

function stop() {
    offsetX = 0;
    offsetY = 0;
	x = 0;
	y = 0;
	send(0,0);
}

function send(m1, m2) {
  var motorsEnabled = document.getElementById("enableMotor").checked;
  var response = "Offest ("+offsetX+"/"+offsetY+") m1:"+m1+" m2:"+m2;
  console.log("send() called" + response);
  if (motorsEnabled)
  {
	alert(document.location);
	  var xmlHttp = new XMLHttpRequest();
	  xmlHttp.open( "GET", "http://192.168.0.112/motor?m1="+m1+"&m2="+m2, false ); // false for synchronous request
	  xmlHttp.send( null );
	  response = xmlHttp.responseText;
  }
  document.getElementById('demo').innerHTML = response;
}

</script>
</body>
</html>
